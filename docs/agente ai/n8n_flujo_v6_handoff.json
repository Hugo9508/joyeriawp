{
    "nodes": [
        {
            "parameters": {
                "httpMethod": "POST",
                "path": "jaflujodev",
                "responseMode": "responseNode",
                "options": {}
            },
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 2.1,
            "position": [
                -700,
                5700
            ],
            "id": "wh-v6",
            "name": "Webhook Chat v6",
            "webhookId": "send-to-whatsapp"
        },
        {
            "parameters": {
                "jsCode": "// ‚îÄ‚îÄ‚îÄ PREPARAR DATOS v6 (con detecci√≥n de handoff) ‚îÄ‚îÄ‚îÄ\nconst body = $input.item.json.body;\n\n// ‚îÄ‚îÄ‚îÄ CASO 1: WhatsApp entrante (Evolution API) ‚îÄ‚îÄ‚îÄ\nif (body.event === 'messages.upsert') {\n  const msgData = body.data;\n  const remoteJid = msgData.key.remoteJidAlt || msgData.key.remoteJid;\n  const phoneNumber = remoteJid.split('@')[0];\n  const isFromSeller = !!msgData.key.fromMe;\n  const messageText = msgData.message?.conversation ||\n                      msgData.message?.extendedTextMessage?.text || '[Multimedia]';\n  return {\n    json: {\n      type: isFromSeller ? 'seller_reply' : 'whatsapp_incoming',\n      phoneNumber,\n      text: messageText,\n      senderName: isFromSeller ? 'Vendedor' : (msgData.pushName || 'Usuario'),\n      timestamp: msgData.messageTimestamp * 1000,\n      conversation_id: '',\n      storeJid: '',\n      isFromSeller\n    }\n  };\n}\n\n// ‚îÄ‚îÄ‚îÄ CASO 2: Web Chat ‚îÄ‚îÄ‚îÄ\nconst data = body.data || body;\nconst clientPhone = String(data.senderPhone || data.phoneNumber || '').replace(/[^0-9]/g, '');\nlet storeRaw = String(data.storeNumber || data.storePhoneNumber || '59895435644').replace(/[^0-9]/g, '');\nlet storeJid = storeRaw;\nif (storeRaw.length === 9) storeJid = '598' + storeRaw;\nconst conversationId = data.conversation_id || body.metadata?.conversation_id || '';\n\n// Detectar comandos del vendedor\nconst text = data.text || body.text || '';\nconst isCommand = text.startsWith('#pausa') || text.startsWith('#activar');\n\nreturn {\n  json: {\n    type: isCommand ? 'command' : 'chat_outgoing',\n    command: isCommand ? text.split(' ')[0].toLowerCase() : '',\n    phoneNumber: clientPhone,\n    senderPhone: clientPhone,\n    senderName: data.senderName || 'Cliente Web',\n    text: text,\n    conversation_id: conversationId,\n    storeJid: storeJid,\n    platform: body.metadata?.platform || 'web_boutique',\n    timestamp: body.metadata?.timestamp ? new Date(body.metadata.timestamp).getTime() : Date.now(),\n    isFromSeller: false\n  }\n};"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                -476,
                5700
            ],
            "id": "prep-v6",
            "name": "Preparar Datos v6"
        },
        {
            "parameters": {
                "rules": {
                    "values": [
                        {
                            "conditions": {
                                "options": {
                                    "caseSensitive": true,
                                    "leftValue": "",
                                    "typeValidation": "strict",
                                    "version": 1
                                },
                                "conditions": [
                                    {
                                        "leftValue": "={{ $json.type }}",
                                        "rightValue": "seller_reply",
                                        "operator": {
                                            "type": "string",
                                            "operation": "equals"
                                        }
                                    }
                                ],
                                "combinator": "and"
                            },
                            "renameOutput": "Vendedor Responde"
                        },
                        {
                            "conditions": {
                                "options": {
                                    "caseSensitive": true,
                                    "leftValue": "",
                                    "typeValidation": "strict",
                                    "version": 1
                                },
                                "conditions": [
                                    {
                                        "leftValue": "={{ $json.type }}",
                                        "rightValue": "command",
                                        "operator": {
                                            "type": "string",
                                            "operation": "equals"
                                        }
                                    }
                                ],
                                "combinator": "and"
                            },
                            "renameOutput": "Comando"
                        },
                        {
                            "conditions": {
                                "options": {
                                    "caseSensitive": true,
                                    "leftValue": "",
                                    "typeValidation": "strict",
                                    "version": 1
                                },
                                "conditions": [
                                    {
                                        "leftValue": "={{ $json.type }}",
                                        "rightValue": "chat_outgoing",
                                        "operator": {
                                            "type": "string",
                                            "operation": "equals"
                                        }
                                    }
                                ],
                                "combinator": "and"
                            },
                            "renameOutput": "Chat Web"
                        },
                        {
                            "conditions": {
                                "options": {
                                    "caseSensitive": true,
                                    "leftValue": "",
                                    "typeValidation": "strict",
                                    "version": 1
                                },
                                "conditions": [
                                    {
                                        "leftValue": "={{ $json.type }}",
                                        "rightValue": "whatsapp_incoming",
                                        "operator": {
                                            "type": "string",
                                            "operation": "equals"
                                        }
                                    }
                                ],
                                "combinator": "and"
                            },
                            "renameOutput": "WhatsApp Entrante"
                        }
                    ]
                },
                "options": {
                    "fallbackOutput": "extra"
                }
            },
            "type": "n8n-nodes-base.switch",
            "typeVersion": 3.2,
            "position": [
                -252,
                5700
            ],
            "id": "router-v6",
            "name": "üîÄ Router"
        },
        {
            "parameters": {
                "jsCode": "// ‚îÄ‚îÄ‚îÄ VENDEDOR RESPONDI√ì ‚Üí PAUSAR IA ‚îÄ‚îÄ‚îÄ\nconst phone = $input.item.json.phoneNumber;\nconst resumeAt = new Date(Date.now() + 30 * 60 * 1000).toISOString();\n\nreturn {\n  json: {\n    client_phone: phone,\n    is_paused: true,\n    paused_by: 'auto',\n    paused_at: new Date().toISOString(),\n    resume_at: resumeAt,\n    seller_name: 'Vendedor',\n    action: 'pause'\n  }\n};"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                0,
                5500
            ],
            "id": "pause-prep",
            "name": "‚è∏Ô∏è Preparar Pausa"
        },
        {
            "parameters": {
                "method": "POST",
                "url": "https://hmcwbizjawrhpkiyydye.supabase.co/rest/v1/chat_handoff",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "apikey",
                            "value": "={{ $env.SUPABASE_KEY }}"
                        },
                        {
                            "name": "Authorization",
                            "value": "=Bearer {{ $env.SUPABASE_KEY }}"
                        },
                        {
                            "name": "Content-Type",
                            "value": "application/json"
                        },
                        {
                            "name": "Prefer",
                            "value": "resolution=merge-duplicates"
                        }
                    ]
                },
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={{ {\n  \"client_phone\": $json.client_phone,\n  \"is_paused\": $json.is_paused,\n  \"paused_by\": $json.paused_by,\n  \"paused_at\": $json.paused_at,\n  \"resume_at\": $json.resume_at,\n  \"seller_name\": $json.seller_name\n} }}",
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
                224,
                5500
            ],
            "id": "upsert-pause",
            "name": "üíæ Guardar Pausa (HTTP)"
        },
        {
            "parameters": {
                "respondWith": "json",
                "responseBody": "={{ { \"success\": true, \"type\": \"handoff\", \"message\": \"IA pausada por 30 min\" } }}",
                "options": {}
            },
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1.5,
            "position": [
                448,
                5500
            ],
            "id": "resp-pause",
            "name": "‚úÖ Resp: Pausa OK"
        },
        {
            "parameters": {
                "jsCode": "// ‚îÄ‚îÄ‚îÄ PROCESAR COMANDO #pausa / #activar ‚îÄ‚îÄ‚îÄ\nconst cmd = $input.item.json.command;\nconst phone = $input.item.json.phoneNumber;\n\nif (cmd === '#pausa') {\n  return {\n    json: {\n      client_phone: phone,\n      is_paused: true,\n      paused_by: 'command',\n      paused_at: new Date().toISOString(),\n      resume_at: new Date(Date.now() + 60 * 60 * 1000).toISOString(),\n      seller_name: 'Vendedor (comando)',\n      response_msg: 'üõë IA pausada para este cliente. Escribe #activar para reactivar.'\n    }\n  };\n} else {\n  return {\n    json: {\n      client_phone: phone,\n      is_paused: false,\n      paused_by: '',\n      paused_at: new Date().toISOString(),\n      resume_at: null,\n      seller_name: '',\n      response_msg: '‚úÖ IA reactivada para este cliente.'\n    }\n  };\n}"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                0,
                5650
            ],
            "id": "cmd-process",
            "name": "üéÆ Procesar Comando"
        },
        {
            "parameters": {
                "method": "POST",
                "url": "https://hmcwbizjawrhpkiyydye.supabase.co/rest/v1/chat_handoff",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "apikey",
                            "value": "={{ $env.SUPABASE_KEY }}"
                        },
                        {
                            "name": "Authorization",
                            "value": "=Bearer {{ $env.SUPABASE_KEY }}"
                        },
                        {
                            "name": "Content-Type",
                            "value": "application/json"
                        },
                        {
                            "name": "Prefer",
                            "value": "resolution=merge-duplicates"
                        }
                    ]
                },
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={{ {\n  \"client_phone\": $json.client_phone,\n  \"is_paused\": $json.is_paused,\n  \"paused_by\": $json.paused_by,\n  \"paused_at\": $json.paused_at,\n  \"resume_at\": $json.resume_at,\n  \"seller_name\": $json.seller_name\n} }}",
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
                224,
                5650
            ],
            "id": "upsert-cmd",
            "name": "üíæ Guardar Estado (HTTP)"
        },
        {
            "parameters": {
                "respondWith": "json",
                "responseBody": "={{ { \"success\": true, \"type\": \"command\", \"message\": $json.response_msg } }}",
                "options": {}
            },
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1.5,
            "position": [
                448,
                5650
            ],
            "id": "resp-cmd",
            "name": "‚úÖ Resp: Comando OK"
        },
        {
            "parameters": {
                "method": "GET",
                "url": "=https://hmcwbizjawrhpkiyydye.supabase.co/rest/v1/chat_handoff?client_phone=eq.{{ $json.phoneNumber }}&limit=1",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "apikey",
                            "value": "={{ $env.SUPABASE_KEY }}"
                        },
                        {
                            "name": "Authorization",
                            "value": "=Bearer {{ $env.SUPABASE_KEY }}"
                        }
                    ]
                },
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
                0,
                5820
            ],
            "id": "check-handoff",
            "name": "üîç Consultar Handoff (HTTP)",
            "continueOnFail": true
        },
        {
            "parameters": {
                "jsCode": "// ‚îÄ‚îÄ‚îÄ DECIDIR SI LA IA PUEDE RESPONDER ‚îÄ‚îÄ‚îÄ\nconst handoffArr = $input.item.json;\nconst originalMsg = $('Preparar Datos v6').item.json;\n\n// La respuesta de Supabase REST es un array\n// Si viene como objeto (por httpRequest), intentar extraer\nlet handoff = null;\nif (Array.isArray(handoffArr)) {\n  handoff = handoffArr[0] || null;\n} else if (handoffArr && handoffArr.client_phone) {\n  handoff = handoffArr;\n}\n\n// Si no hay registro de handoff, la IA est√° activa\nif (!handoff) {\n  return { json: { ...originalMsg, ai_active: true } };\n}\n\n// Si est√° pausado pero ya pas√≥ el tiempo de resume\nif (handoff.is_paused && handoff.resume_at) {\n  const resumeTime = new Date(handoff.resume_at).getTime();\n  if (Date.now() > resumeTime) {\n    return { json: { ...originalMsg, ai_active: true, expired_pause: true } };\n  }\n}\n\n// Si est√° pausado y el timer no ha expirado\nif (handoff.is_paused) {\n  return { json: { ...originalMsg, ai_active: false } };\n}\n\n// No est√° pausado\nreturn { json: { ...originalMsg, ai_active: true } };"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                224,
                5820
            ],
            "id": "decide-ai",
            "name": "üß† ¬øIA Activa?"
        },
        {
            "parameters": {
                "conditions": {
                    "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 1
                    },
                    "conditions": [
                        {
                            "leftValue": "={{ $json.ai_active }}",
                            "rightValue": true,
                            "operator": {
                                "type": "boolean",
                                "operation": "equals"
                            }
                        }
                    ],
                    "combinator": "and"
                },
                "options": {}
            },
            "type": "n8n-nodes-base.if",
            "typeVersion": 2,
            "position": [
                448,
                5820
            ],
            "id": "if-ai-active",
            "name": "¬øIA Activa?"
        },
        {
            "parameters": {
                "resource": "messages-api",
                "instanceName": "Maya",
                "remoteJid": "={{ $json.storeJid }}",
                "messageText": "=üõçÔ∏è *Web Boutique*\nüë§ {{ $json.senderName }} ({{ $json.senderPhone }})\nüí¨ {{ $json.text }}",
                "options_message": {}
            },
            "type": "n8n-nodes-evolution-api.evolutionApi",
            "typeVersion": 1,
            "position": [
                672,
                5700
            ],
            "id": "notify-seller-v6",
            "name": "üì§ Notificar Vendedor",
            "credentials": {
                "evolutionApi": {
                    "id": "6r5z9RoXouEeeobi",
                    "name": "Evolution Maya"
                }
            }
        },
        {
            "parameters": {
                "user": "={{ $json.phoneNumber }}",
                "query": "={{ $json.text }}",
                "conversationId": "={{ $json.conversation_id }}",
                "responseMode": "blocking"
            },
            "type": "n8n-nodes-difyai.difyAi",
            "typeVersion": 1,
            "position": [
                672,
                5820
            ],
            "id": "dify-v6",
            "name": "ü§ñ Dify (Blocking)",
            "credentials": {
                "difyApi": {
                    "id": "4VHrD6jV7wt07VYZ",
                    "name": "Dify account"
                }
            },
            "continueOnFail": true
        },
        {
            "parameters": {
                "jsCode": "// ‚îÄ‚îÄ‚îÄ VERIFICAR RESPUESTA DE DIFY ‚îÄ‚îÄ‚îÄ\nconst item = $input.item.json;\nconst answer = item.answer || item.response || item.data?.answer || '';\nconst conversationId = item.conversation_id || item.data?.conversation_id || '';\nconst hasError = !!item.error || !answer.trim();\n\nreturn {\n  json: {\n    success: !hasError,\n    answer: answer.trim(),\n    conversation_id: conversationId,\n    error: hasError ? (item.error || 'Respuesta vac√≠a de Dify') : null\n  }\n};"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                896,
                5820
            ],
            "id": "verify-dify-v6",
            "name": "üîç Verificar Respuesta"
        },
        {
            "parameters": {
                "conditions": {
                    "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 1
                    },
                    "conditions": [
                        {
                            "leftValue": "={{ $json.success }}",
                            "rightValue": true,
                            "operator": {
                                "type": "boolean",
                                "operation": "equals"
                            }
                        }
                    ],
                    "combinator": "and"
                },
                "options": {}
            },
            "type": "n8n-nodes-base.if",
            "typeVersion": 2,
            "position": [
                1120,
                5820
            ],
            "id": "if-dify-ok",
            "name": "¬øDify OK?"
        },
        {
            "parameters": {
                "respondWith": "json",
                "responseBody": "={{ {\n  \"success\": true,\n  \"type\": \"bot_response\",\n  \"response\": $json.answer,\n  \"conversation_id\": $json.conversation_id,\n  \"phoneNumber\": $('Preparar Datos v6').item.json.phoneNumber\n} }}",
                "options": {}
            },
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1.5,
            "position": [
                1344,
                5740
            ],
            "id": "resp-ok-v6",
            "name": "‚úÖ Responder OK"
        },
        {
            "parameters": {
                "respondWith": "json",
                "responseBody": "={{ {\n  \"success\": true,\n  \"type\": \"bot_response\",\n  \"response\": \"Gracias por tu inter√©s. En este momento tengo mucha demanda y no puedo responderte al instante. Para una atenci√≥n personalizada, te invito a escribirnos directamente por WhatsApp haciendo clic en el √≠cono verde de abajo. ¬°Estaremos encantados de atenderte! ‚ú®\",\n  \"conversation_id\": \"\",\n  \"phoneNumber\": $('Preparar Datos v6').item.json.phoneNumber\n} }}",
                "options": {}
            },
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1.5,
            "position": [
                1344,
                5920
            ],
            "id": "resp-fallback-v6",
            "name": "‚ö†Ô∏è Responder Fallback"
        },
        {
            "parameters": {
                "respondWith": "json",
                "responseBody": "={{ {\n  \"success\": true,\n  \"type\": \"bot_response\",\n  \"response\": \"¬°Hola! Ahora mismo nuestro equipo de ventas est√° atendiendo tu consulta personalmente. Te responderemos a la brevedad por WhatsApp. üòä\",\n  \"conversation_id\": $('Preparar Datos v6').item.json.conversation_id || '',\n  \"phoneNumber\": $('Preparar Datos v6').item.json.phoneNumber\n} }}",
                "options": {}
            },
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1.5,
            "position": [
                672,
                5960
            ],
            "id": "resp-paused",
            "name": "ü§ù Resp: Vendedor Atendiendo"
        },
        {
            "parameters": {
                "resource": "messages-api",
                "instanceName": "Maya",
                "remoteJid": "={{ $('Preparar Datos v6').item.json.storeJid }}",
                "messageText": "=ü§ñ *Respuesta IA para {{ $('Preparar Datos v6').item.json.senderName }}*\n\n{{ $json.answer }}",
                "options_message": {}
            },
            "type": "n8n-nodes-evolution-api.evolutionApi",
            "typeVersion": 1,
            "position": [
                1568,
                5740
            ],
            "id": "notify-ia-resp",
            "name": "üì§ Notificar Respuesta IA",
            "credentials": {
                "evolutionApi": {
                    "id": "6r5z9RoXouEeeobi",
                    "name": "Evolution Maya"
                }
            }
        },
        {
            "parameters": {
                "resource": "messages-api",
                "instanceName": "Maya",
                "remoteJid": "={{ $json.storeJid }}",
                "messageText": "=üí¨ *Cliente Web (IA pausada)*\nüë§ {{ $json.senderName }} ({{ $json.senderPhone }})\nüí¨ {{ $json.text }}\n\n‚ö†Ô∏è _Record√° que la IA est√° pausada para este cliente._",
                "options_message": {}
            },
            "type": "n8n-nodes-evolution-api.evolutionApi",
            "typeVersion": 1,
            "position": [
                672,
                6080
            ],
            "id": "notify-paused",
            "name": "üì§ Notificar (Pausado)",
            "credentials": {
                "evolutionApi": {
                    "id": "6r5z9RoXouEeeobi",
                    "name": "Evolution Maya"
                }
            }
        },
        {
            "parameters": {
                "method": "POST",
                "url": "https://joyeria.a380.com.br/api/webhook",
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={{ {\n  \"text\": $json.text,\n  \"senderName\": $json.senderName,\n  \"timestamp\": $json.timestamp,\n  \"phoneNumber\": $json.phoneNumber,\n  \"type\": \"whatsapp_incoming\"\n} }}",
                "options": {
                    "response": {
                        "response": {}
                    }
                }
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
                0,
                6000
            ],
            "id": "wa-to-web",
            "name": "üì® WhatsApp ‚Üí Chat Web"
        },
        {
            "parameters": {
                "respondWith": "json",
                "responseBody": "={{ { \"success\": true, \"type\": \"whatsapp\", \"message\": \"WhatsApp recibido\" } }}",
                "options": {}
            },
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1.5,
            "position": [
                224,
                6000
            ],
            "id": "resp-wa-ok",
            "name": "‚úÖ Resp: WhatsApp OK"
        }
    ],
    "connections": {
        "Webhook Chat v6": {
            "main": [
                [
                    {
                        "node": "Preparar Datos v6",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Preparar Datos v6": {
            "main": [
                [
                    {
                        "node": "üîÄ Router",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "üîÄ Router": {
            "main": [
                [
                    {
                        "node": "‚è∏Ô∏è Preparar Pausa",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "üéÆ Procesar Comando",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "üîç Consultar Handoff (HTTP)",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "üì® WhatsApp ‚Üí Chat Web",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "‚è∏Ô∏è Preparar Pausa": {
            "main": [
                [
                    {
                        "node": "üíæ Guardar Pausa (HTTP)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "üíæ Guardar Pausa (HTTP)": {
            "main": [
                [
                    {
                        "node": "‚úÖ Resp: Pausa OK",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "üéÆ Procesar Comando": {
            "main": [
                [
                    {
                        "node": "üíæ Guardar Estado (HTTP)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "üíæ Guardar Estado (HTTP)": {
            "main": [
                [
                    {
                        "node": "‚úÖ Resp: Comando OK",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "üîç Consultar Handoff (HTTP)": {
            "main": [
                [
                    {
                        "node": "üß† ¬øIA Activa?",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "üß† ¬øIA Activa?": {
            "main": [
                [
                    {
                        "node": "¬øIA Activa?",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "¬øIA Activa?": {
            "main": [
                [
                    {
                        "node": "üì§ Notificar Vendedor",
                        "type": "main",
                        "index": 0
                    },
                    {
                        "node": "ü§ñ Dify (Blocking)",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "ü§ù Resp: Vendedor Atendiendo",
                        "type": "main",
                        "index": 0
                    },
                    {
                        "node": "üì§ Notificar (Pausado)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "ü§ñ Dify (Blocking)": {
            "main": [
                [
                    {
                        "node": "üîç Verificar Respuesta",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "üîç Verificar Respuesta": {
            "main": [
                [
                    {
                        "node": "¬øDify OK?",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "¬øDify OK?": {
            "main": [
                [
                    {
                        "node": "‚úÖ Responder OK",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "‚ö†Ô∏è Responder Fallback",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "‚úÖ Responder OK": {
            "main": [
                [
                    {
                        "node": "üì§ Notificar Respuesta IA",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "üì® WhatsApp ‚Üí Chat Web": {
            "main": [
                [
                    {
                        "node": "‚úÖ Resp: WhatsApp OK",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        }
    },
    "pinData": {},
    "meta": {
        "templateCredsSetupCompleted": true,
        "instanceId": "48879120a3f3dc46e2394aadd0f93e174d47f6eef6bd3799c4f575c713076dca"
    }
}